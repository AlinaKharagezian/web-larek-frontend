# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Интерфейсы данных приложения: 

### 1. Интерфейс товара - `IProduct`:

```
interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

***

### 2. Интерфейс, описывающий данные для формы заказа - `IOrderForm`:

```
interface IOrderForm {
    payment: string;
    email: string;
    phone: string;
    address: string;
}
```

***

### 3. Интерфейс `IOrder`, являющийся расширением интерфейса IOrderForm, который добавляет информацию о содержимом и стоимости заказа:

```
interface IOrder extends IOrderForm {
    items: string[];
    total: number;
}
```

***

### 4. Интерфейс, описывающий ответ от сервера после успешного оформления заказа - IOrderResult:

```
interface IOrderResult {
    id: string;
    total: number;
}
```

***

### 5. Тип, хранящий ошибки валидации форм, основанный на IOrderForm - FormErrors:

```
type FormErrors = Partial<Record<keyof IOrderForm, string>>;
```

***

# Архитектура проекта: 

Данный проект построен на архитектуре `MVP (Model-View-Presenter)`, которая делит приложение на три основных слоя:

`M/Модель` — Слой данных и бизнес-логики, отвечающий за хранение состояния приложения, валидацию данных и взаимодействие с сервером.

`V/Представление` — Слой отображения, отвечающий за визуализацию данных.

`P/Презентер` — Слой управления, связывающий модель и представление. 

# Базовые классы:

### 1.Класс API - базовый класс для взаимодействия с сервером посредством запросов:

###### Конструктор: 

`constructor(baseUrl: string, options: RequestInit = {})` - конструктор принимает базовый url сервера и опциональный объект, который содержит заголовки для запросов;

###### Поля класса:

`baseUrl: string` - базовый адрес (url) сервера.

`options: RequestInit` - объект с заголовками для запросов.

###### Методы класса: 

`get(uri: string)` - выполняет `GET-запрос` на указанный ендпоинт(принимает относительный путь);

`post(uri: string, data: object, method: ApiPostMethods = 'POST')` - выполняет по умолчанию `POST` запрос с телом data на указанный ендпоинт. Принимает: относительный путь, объект и аргумент для изменения метода запроса.

`handleResponse(response: Response): Promise<object>` - обрабатывает ответ сервера, возвращая `json` в случае успеха или ошибку в противном случае. Принимает: объект ответа. Возвращает: Промис, преобразуемый в json-объект.


***

### 2.Класс Component - базовый класс для всех ui-компонентов представления:

###### Конструктор: 

`constructor(protected readonly container: HTMLElement)` - конструктор принимает корневой DOM-элемент компонента;

###### Методы класса: 

`toggleClass(element: HTMLElement, className: string, force?: boolean)` - Переключает класс на указанном элементе. Принимает элемент, на котором нужно переключить класс, имя класса и true/false аргумент для переключения.

`setText(element: HTMLElement, value: unknown)` - Устанавливает текстовое содержимое указанного элемента. Принимает: элемент для изменения и значение, которое будет установлено.

`setDisabled(element: HTMLElement, state: boolean)` - Сменяет статус блокировки. Принимает: интерактивный элемент и логическое значение true/false.

`setHidden(element: HTMLElement)` - Скрывает элемент. Принимает: элемент, который нужно скрыть.

`setVisible(element: HTMLElement)` - Показывает элемент. Принимает: элемент, который нужно показать.

`setImage(element: HTMLImageElement, src: string, alt?: string)` - Устанавливает изображение с алтернативным текстом. Принимает: элемент, путь к изображению и необязательный альтернативный текст.

`render(data?: Partial<T>): HTMLElement` - Возвращает корневой DOM-элемент. Принимает: необязательные данные для рендеринга.


***

### 3.Класс Model - базовый класс, представляющий собой основу для модели данных:

###### Конструктор: 

`constructor(data: Partial<T>, protected events: IEvents)` - конструктор принимает начальные данные и экземпляр `EventEmitter`;


###### Методы класса: 

`emitChanges(event: string, payload?: object)` - генерирует событие об изменениях в модели. Принимает: имя события и необязательную дополнительную информацию о событии.


***

### 4.Класс EventEmitter - базовый класс для связи между слоями данных и представления без прямой зависимости:

###### Конструктор: 

`constructor()` - конструктор инициализирует брокер событий;

###### Поля класса:

`_events: Map<string, Function[]>` - объект, хранящий все события и обработчики этих событий.

###### Методы класса: 

`on(eventName: string, handler: (payload?: any) => void)` - назначает обработчик для указанного события. Принимает: имя события и функцию, которая будет вызвана при этом событии.

`off(eventName: string, handler: (payload?: any) => void)` - снимает обработчик для указанного события. Принимает: имя события и функцию, которая была ранее назначена.

`emit(eventName: string, payload?: object)` - вызывает все обработчкии указанного события. Принимает: имя события и необязательную дополнительную информацию о событии.

`onAll(handler: (eventName: string, payload?: any) => void)` - регистрирует обработчик для вызова у всех событий. Принимает: функцию, получающую имя события и данные при каждом его появлении.

`offAll()` - очищает все обработчики всех событий.



# Слой данных:

### 1.Класс AppData - класс, расширяющий базовый класс Model. Отвечает за состояние всего приложения:

###### Поля класса:

`basket: IProduct[]` - массив товаров корзины.

`catalog: IProduct[]` - массив товаров корзины.

`order: IOrder` - объект данных для заказа.

`preview: string | null` - идентификатор товара для превью.

`formErrors: FormErrors` - объект для хранения ошибок валидации форм.


###### Методы класса: 

`isInBasket(item: IProduct): boolean` - проверяет наличие товара в корзине. Принимает: объект товара. Возвращает: true/false, т.е в корзине/не в корзине

`toggleBasketItem(item: IProduct, added: boolean)>` - добавляет товар в корзину или удаляет его из нее. Принимает: объект товара и логическое значение true/false для удаления/добавления.

`clearBasket()` - полностью очищает корзину.

`resetOrderForm()` - полностью сбрасывает поля формы и ошибки валидации формы.

`getTotal()` - вычисляет общую стоимость товаров, находящихся в корзине, и возвращает ее.

`setCatalog(items: IProduct[])` - обновляет список товаров. Принимает: массив товаров.

`setPreview(item: IProduct)` - устанавливает товар для предпросмотра. Принимает: объект товара.

`setOrderField(field: keyof IOrderForm, value: string)` - устанавливает значение конкретного поля формы заказа. Принимает имя поля и значение для установки.

`validateOrder(): boolean` - валидирует форму заказа. Возвращает: true/false, т.е нет ошибок/есть ошибки.

`validateContacts(): boolean` - валидирует форму контактов. Возвращает: true/false, т.е нет ошибок/есть ошибки.

`setOrder()` - подготавливает данные заказа (товары и их общую стоимость)

***


### 1.Класс WebLarekApi - класс, расширяющий базовый класс API. Отвечает за взаимодействие с сервером:

###### Конструктор: 

`constructor(cdn: string, baseUrl: string, options?: RequestInit)` - конструктор принимает базовые url для CDN и API серверов, а так же необязательные дополнительыне данные для запросов;

###### Поля класса:

`cdn: string` - адрес CDN.

###### Методы класса: 

`getProductList(): Promise<IProduct[]>` - инициирует `GET-запрос` для получения карточек товаров. Возвращает: Промис, преобразуемый в массив объектов товаров.

`orderProducts(order: IOrder): Promise<IOrderResult>` - инициирует `POST-запрос` для отправки данных заказа. Принимает: объект данных заказа. Возвращает: Промис, преобразумемый в объект с результатами по заказу. 

***




# Слой представления:

### 1.Класс Page - класс, расширяющий базовый класс Component. Отвечает за управление отображением основных элементов страницы:

###### Конструктор: 

`constructor(container: HTMLElement, protected events: IEvents)` - конструктор принимает корневой DOM-элемент страницы и экземпляр `EventEmitter`;

###### Поля класса:

`_counter: HTMLElement` - счетчик товаров в корзине.

`_catalog: HTMLElement` - контейнер для товаров на странице.

`_wrapper: HTMLElement` - элемент обертки страницы.

`_basket: HTMLElement` - элемент корзины на странице.


###### Методы класса: 

`set counter(value: number)` - устанавливает счетчик товаров в корзине 

`set catalog(items: HTMLElement[])` - заменяет содержимое каталога переданными значениями массива, который принимает.

`set locked(value: boolean)` - меняет статус скроллинга. Принимает: true/false, т.е. блокировка прокрутки/разблокировка прокрутки.

***


### 2.Класс Card - класс, расширяющий базовый класс Component. Отвечает за отображение карточки товара:

###### Конструктор: 

`constructor(container: HTMLElement, actions?: ICardActions)` - конструктор принимает DOM-элемент карточки и обработчики событий;

###### Поля класса:

` _categoryСolor: Record<string, string>` - объект, сопоставляющий названия категорий и классы css.

`_title: HTMLElement` - заголовок товара.

`_image?: HTMLImageElement` - картинка товара.

`_description?: HTMLElement` - необязательное описание товара.

`_button?: HTMLButtonElement` - необязательная кнопка товара.

`_price: HTMLElement` - цена товара.

`_category?: HTMLElement` - категория товара.

`blockName = 'card'` - строка-префикс для селекторов.


###### Методы класса: 

`set id(value: string)` - сеттер для установки id товара. Принимает: строку с уникальным идентификатором.

`get id(): string ` - геттер для получения id товара. Возвращает: строку с уникальным идентификатором.

`set title(value: string) ` - сеттер для установки заголовка карточки. Принимает: строку с текстом заголовка.

`get title(): string ` - геттер для получения заголовка карточки. Возвращает: строку с текстом заголовка.

`set image(value: string) ` - сеттер для установки картинки товара. Принимает: строку с url-адресом.

`set description(value: string)` - сеттер для установки текста описания карточки. Принимает: строку с текстом описания.

`set category(value: string) ` - сеттер для установки текста и стиля категории. Принимает: строку с категорией товара.

`set price(value: number | null) ` - сеттер для установки цены товара. Принимает: число или null - значение цены.

`updateButton(isInBasket: boolean)` - изменяет значение текста кнопки. Принимает: логическое значение true/false, в зависимости от которого устанавливается тот или иной текст.

***

### 2.Класс Modal - класс, расширяющий базовый класс Component. Отвечает за управление модальным окном:

###### Конструктор: 

` constructor(container: HTMLElement, protected events: IEvents)` - конструктор принимает DOM-элемент карточки и обработчики событий;

###### Поля класса:

` _categoryСolor: Record<string, string>` - объект, сопоставляющий названия категорий и классы css.

`_title: HTMLElement` - заголовок товара.

`_image?: HTMLImageElement` - картинка товара.

`_description?: HTMLElement` - необязательное описание товара.

`_button?: HTMLButtonElement` - необязательная кнопка товара.

`_price: HTMLElement` - цена товара.

`_category?: HTMLElement` - категория товара.

`blockName = 'card'` - строка-префикс для селекторов.


###### Методы класса: 

`set id(value: string)` - сеттер для установки id товара. Принимает: строку с уникальным идентификатором.

`get id(): string ` - геттер для получения id товара. Возвращает: строку с уникальным идентификатором.

`set title(value: string) ` - сеттер для установки заголовка карточки. Принимает: строку с текстом заголовка.

`get title(): string ` - геттер для получения заголовка карточки. Возвращает: строку с текстом заголовка.

`set image(value: string) ` - сеттер для установки картинки товара. Принимает: строку с url-адресом.

`set description(value: string)` - сеттер для установки текста описания карточки. Принимает: строку с текстом описания.

`set category(value: string) ` - сеттер для установки текста и стиля категории. Принимает: строку с категорией товара.

`set price(value: number | null) ` - сеттер для установки цены товара. Принимает: число или null - значение цены.

`updateButton(isInBasket: boolean)` - изменяет значение текста кнопки. Принимает: логическое значение true/false, в зависимости от которого устанавливается тот или иной текст.

***













